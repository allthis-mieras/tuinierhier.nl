---
import type { CollectionEntry } from "astro:content";
import { Image } from "astro:assets";

import MainLayout from "../layouts/MainLayout.astro";
import FormattedDate from "../components/common/FormattedDate.astro";
import Tag from "../components/common/Tag.astro";

type Props = CollectionEntry<"blog">["data"];

const { title, description, pubDate, updatedDate, heroImage } = Astro.props;
---

<MainLayout {title} {description} image={heroImage.src}>
  <article class="post">
    <div class="date">
      <div class="date-header">
        <a href="/#news" class="back-to-news">
          <Tag variant="news">←</Tag>
        </a>
        <Tag variant="news">
          <FormattedDate date={pubDate} />
        </Tag>
      </div>
      {
        updatedDate && (
          <div class="last-updated-on">
            Last updated on <FormattedDate date={updatedDate} />
          </div>
        )
      }

      <h1 class="title">{title}</h1>
    </div>
    <div class="hero-image">
      <Image
        src={heroImage.src}
        alt={heroImage.alt}
        width={1600}
        height={900}
        format="avif"
        sizes="(max-width: 768px) 100vw, (max-width: 1200px) 80vw, 60vw"
        loading="eager"
        quality={85}
      />
    </div>
    <slot />

    <a href="/#news" class="back-to-news">
      <Tag variant="news">← Meer nieuws</Tag>
    </a>
  </article>
</MainLayout>

<style>
  article {
    padding: var(--space-s-2xl);
    max-width: 960px;
    margin: 0 auto;
    position: relative;
  }

  .date-header {
    display: flex;
    align-items: center;
    gap: var(--space-2xs);
    margin-bottom: var(--space-xs);
  }

  .back-to-news {
    text-decoration: none;
    transition: transform 0.2s ease;
  }

  .back-to-news:hover {
    transform: translateX(-2px);
  }

  .title {
    margin: 1rem 0 0 0;
    padding: 0;
    font-size: var(--step-5);
    font-weight: 700;
    line-height: 1.2;
  }

  /* Scoped markdown content styling */
  :global(.post p) {
    font-size: var(--step--1);
    line-height: 150%;
    margin: var(--space-m) 0;
  }

  /* Remove top margin from p after headings */
  :global(.post h1 + p),
  :global(.post h2 + p),
  :global(.post h3 + p),
  :global(.post h4 + p),
  :global(.post h5 + p),
  :global(.post h6 + p) {
    margin-top: 0;
  }

  :global(.post h1),
  :global(.post h2),
  :global(.post h3),
  :global(.post h4),
  :global(.post h5),
  :global(.post h6) {
    font-size: var(--step-2);
    margin-top: var(--space-m);
    margin-bottom: var(--space-3xs);
    font-weight: 700;
  }

  :global(.post h1) {
    font-size: var(--step-3);
  }

  :global(.post h2) {
    font-size: var(--step-2);
  }

  :global(.post h3) {
    font-size: var(--step-1);
  }

  :global(.post blockquote) {
    font-size: var(--step--1);
    line-height: 150%;
    margin: var(--space-m) 0;
    padding-left: var(--space-m);
    border-left: 3px solid var(--clr-green);
    font-style: italic;
  }

  :global(.post ul),
  :global(.post ol) {
    margin: var(--space-m) 0;
    padding-left: var(--space-l);
  }

  :global(.post li) {
    margin: var(--space-xs) 0;
    font-size: var(--step--1);
    line-height: 150%;
  }

  /* Nested list spacing adjustments */
  :global(.post li > ul),
  :global(.post li > ol) {
    margin-top: var(--space-xs);
    margin-bottom: 0;
    padding-left: var(--space-m);
  }

  :global(.post code) {
    background: var(--clr-yellow);
    padding: 0.125rem 0.25rem;
    border-radius: var(--radius-sm);
    font-size: 0.875em;
  }

  :global(.post pre) {
    background: var(--clr-yellow);
    padding: var(--space-m);
    border-radius: var(--radius);
    overflow-x: auto;
    margin: var(--space-m) 0;
  }

  :global(.post pre code) {
    background: none;
    padding: 0;
  }

  :global(.post a) {
    color: var(--clr-green);
    text-decoration: underline;
  }

  :global(.post a:hover) {
    color: var(--clr-navy);
  }

  :global(.post img) {
    max-width: 100%;
    height: auto;
    border-radius: var(--radius);
    margin: var(--space-m) 0;
  }

  :global(.post hr) {
    border: none;
    height: 1px;
    background: var(--clr-green);
    margin: var(--space-l) 0;
  }

  .hero-image {
    border-radius: var(--radius-lg);
    overflow: hidden;
  }

  .hero-image img {
    width: 100%;
    height: auto;
    display: block;
    object-fit: cover;
  }

  /* Responsive hero image */
  @media (max-width: 768px) {
    .hero-image {
      margin: var(--space-m) 0;
      border-radius: var(--radius);
    }
  }

  .back-to-news {
    text-decoration: none;
    display: inline-block;

    transition: transform 0.2s ease;
  }

  .back-to-news:hover {
    transform: translateX(-2px);
  }
</style>
